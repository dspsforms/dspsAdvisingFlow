<form *ngIf="form" [formGroup]="form" (ngSubmit)="createOrEditForm()" >
  <!-- <h1 class="ion-padding">DSPS ACADEMIC ACCOMMODATIONS PLAN (AAP) - Part 2</h1> -->


  <app-aap2header [form]="form" [grid]="grid" [mode]="mode"></app-aap2header>

  <app-long-term-ed-goal [form]="form" [grid]="grid"></app-long-term-ed-goal>
  
  
  

  <ion-grid>
   
    <ion-row  *ngIf="mode !== 'view'">
  
      <ion-col size-sm="3" offset-sm="2">
        <ion-button 
          type="submit"  
          [disabled]="!form.valid" >Save</ion-button>
      </ion-col>
  
      <ion-col size-sm="3">
        <ion-button 
          type="button"  
          fill="outline" 
          color="tertiary"
          (click)="onCancel()">
          Cancel
        </ion-button>
      </ion-col>
    </ion-row>  <!-- submit and cancel buttons -->
  
    <ion-row  *ngIf="mode !== 'create'">
      <ion-col size-sm="5">
        <ion-item *ngIf="lastModifiedBy"  >
          <ion-label >
            Last edited by  {{ lastModifiedBy }},  {{ lastModified | date }}.
          </ion-label>
        </ion-item>
      </ion-col>
      <ion-col size-sm="2">
          <ion-item *ngIf="currentVersion"  >
            <ion-label >
               Version:  {{ currentVersion }}
            </ion-label>
          </ion-item>
      </ion-col>

      <!-- if studentUser, mode is definitely view -->
      <ion-col 
          *ngIf="studentUser && wrappedForm.studentSigStatus === 'pending'" 
          size-sm="2" offset-sm="3">
        <app-sign-it 
          [wrappedForm]="wrappedForm"
          [studentUser]="studentUser"
          (signed)="onSigned($event)"
        ></app-sign-it>
      </ion-col>
    
    </ion-row>

    <!--- show the signature, if it exists, only in view mode -->
    <app-sig-view 
    *ngIf="mode === 'view'"  
    [signatures]="wrappedForm.signatures"
    [sigStatus]="wrappedForm.studentSigStatus" 
    [focusOnSignature]="focusOnSignature" ></app-sig-view>

   
  
  </ion-grid>

  <!-- aap2 info. exclude if create. also exclude if edit unless children > 0 -->
  <app-aap2-info *ngIf="mode === 'view' || wrappedForm?.children?.length > 0 ">
  </app-aap2-info>

  <div class="tiny" tabindex="-1" #aap2ChildStart > </div>

  <!-- children -->
  <div *ngIf="mode === 'view'  && wrappedForm?.children?.length > 0">

    <app-aap2-child 
      *ngFor="let child of wrappedForm.children;" 
      [mode]="'view'"  
      [wrappedForm]="child"
      [parentFormData]="wrappedForm"
      [studentUser]="studentUser"
      >
    </app-aap2-child>

  </div>

  <div *ngIf="mode === 'view'">

    <ion-grid>
      <ion-row  *ngIf="mode === 'view'">
        <ion-col size-sm="3" offset-sm="9">
          <ion-button 
            type="button"
            fill="clear"
            expand="block"
            color="primary"
            (click)="toggleNewProgressReport()" >
            {{ showNewProgressReport? 'Hide' : 'Add'}} New Progress Report
          </ion-button>
        </ion-col>

      </ion-row>
    </ion-grid>

    <div *ngIf="showNewProgressReport" class="add-line-delimiter">

      <h2 class="ion-text-center gap-top">New Progress Objective </h2>

      <app-aap2-child 
        [mode]="'create'"  
        [parentFormData]="wrappedForm || form"></app-aap2-child>

      <div class="tiny" tabindex="1" #newProgress > </div>
  
    </div>

  </div>

    

  
  

    <!--- show the signature, if it exists, only in view mode -->
    <!-- <app-sig-view 
    *ngIf="mode === 'view'"  
    [signatures]="wrappedForm.signatures"
    [sigStatus]="wrappedForm.studentSigStatus" 
    [focusOnSignature]="focusOnSignature" ></app-sig-view> -->


</form>
